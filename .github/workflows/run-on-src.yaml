name: Run Tests
on:
  pull_request:
    branches:
      - main
jobs:
  check-for-test:
    runs-on: ubuntu-latest
    outputs:
      src_changed: ${{ steps.changed-files.outputs.src_changed }}
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 2
      - name: Check changed files
        id: changed-files
        run: |
          if git diff --quiet HEAD~ HEAD ./src; then
            echo "No changes in src."
            echo "src_changed=false" >> $GITHUB_ENV
          else
            echo "Changes found in src."
            echo "src_changed=true" >> $GITHUB_ENV
          fi
  run-tests:
    runs-on: ubuntu-latest
    needs: check-for-test
    if: "${{ needs.check-for-test.outputs.src_changed }}" == "true"
    steps:
      - uses: ./.github/workflows/test_only_on_some_files.yaml
